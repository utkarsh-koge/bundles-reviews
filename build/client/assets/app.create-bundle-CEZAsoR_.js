import{r as l,j as e}from"./index-C2MVcWue.js";import{g as F,S as Y,R as J,a as K,b as q,B as z,C as ne,c as se,T as ae,d as ie}from"./product.helpers-vfyxMMcL.js";import{u as oe,a as re,b as le,c as de}from"./components-C2Kax0p1.js";import{C as Q,B as b,a as $,T as H,P as ce}from"./Page-D05pyoXj.js";import{a as I,I as E,T as d,B as W,b as V}from"./hooks-DVLPNyJj.js";import{D as ue,T as he}from"./Toast-DBnrqZxP.js";import{M as L}from"./Modal-CzgmPlWy.js";import{I as me}from"./use-deep-effect-D6mXDaV_.js";import{T as ge,L as G}from"./TitleBar-CSDd_GFP.js";import"./banner-context-DY3IUZWM.js";import"./context-BTfEV6tP.js";import"./context-C3QIEavF.js";function pe(){const{products:c,bundles:a}=oe(),s=re(),u=le(),h=de().state==="submitting",[m,r]=l.useState(!1),[o,B]=l.useState("create"),[v,S]=l.useState(null),[y,g]=l.useState(""),[C,x]=l.useState([]),[M,w]=l.useState(!1),[n,j]=l.useState(""),[k,A]=l.useState(!1),[P,T]=l.useState(""),D=new Map(c.map(i=>[i.id,i]));l.useEffect(()=>{s&&(j(s.message||s.error||"Action completed."),A(!s.success),s.success&&(r(!1),g(""),x([]),S(null)),w(!0))},[s]);const X=l.useCallback(()=>w(i=>!i),[]),Z=(i,p=null)=>{if(B(i),S(p),i==="edit"&&p){g(p.name);const f=p.productIds.map(F);x(f)}else i==="create"&&(g(""),x([]));r(!0)},_=l.useCallback(()=>{r(!1),g(""),x([]),S(null),T("")},[]),O=l.useCallback(i=>{x(p=>p.includes(i)?p.filter(f=>f!==i):[...p,i])},[]),ee=l.useCallback((i,p)=>{const f=new FormData;f.append("intent",i),f.append("bundleName",y.trim()),p&&f.append("bundleId",p),[...C].sort((N,U)=>{const R=v?F(v.bundleProductId):C[0];return N===R&&U!==R?-1:U===R&&N!==R?1:0}).forEach(N=>{f.append("productIds[]",N)}),u(f,{method:"post"})},[y,C,v,u]),te=c.filter(i=>i.title.toLowerCase().includes(P.toLowerCase())||i.numericId.includes(P));return{products:c,bundles:a,isSubmitting:h,activeModal:m,modalType:o,currentBundle:v,bundleName:y,selectedProductGids:C,activeToast:M,toastMessage:n,toastError:k,productSearchTerm:P,productMap:D,filteredProducts:te,setBundleName:g,setProductSearchTerm:T,toggleActiveToast:X,handleModalOpen:Z,handleModalClose:_,handleProductSelection:O,handleFormSubmit:ee,setActiveToast:w}}function xe({bundles:c,isSubmitting:a,handleModalOpen:s,getProductsForBundle:u}){return e.jsxs(Q,{padding:"0",children:[e.jsxs(I,{padding:"400",children:[e.jsxs(E,{align:"space-between",blockAlign:"center",children:[e.jsxs(d,{as:"h2",variant:"headingLg",fontWeight:"semibold",children:["Existing Review Bundles (",c.length,")"]}),e.jsx(W,{variant:"primary",icon:Y,onClick:()=>s("create",null),disabled:a,children:"Create New Bundle"})]}),e.jsx(I,{paddingBlockStart:"400",children:e.jsx(ue,{})})]}),c.length>0?e.jsx(J,{resourceName:{singular:"bundle",plural:"bundles"},items:c,renderItem:t=>{const h=u(t),m=h.find(o=>o.numericId===t.bundleProductId),r=h.length-1;return e.jsx(K,{id:t.id,url:"#",media:e.jsx(I,{background:"bg-fill-tertiary",borderRadius:"300",padding:"300",children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(V,{source:q,tone:"base"})})}),accessibilityLabel:`View bundle ${t.name}`,shortcutActions:[{content:"Edit",onAction:()=>s("edit",t),disabled:a},{content:"Delete",onAction:()=>s("delete",t),disabled:a}],children:e.jsxs(b,{gap:"100",children:[e.jsx(d,{as:"h3",variant:"bodyLg",fontWeight:"semibold",children:t.name}),e.jsxs(E,{gap:"100",blockAlign:"center",wrap:!1,children:[e.jsx($,{size:"small",tone:"success",children:`Main: ${(m==null?void 0:m.title)||"Unknown Product"}`}),r>0&&e.jsx($,{size:"small",children:`+${r} ${r===1?"Product":"Products"}`})]}),e.jsxs(d,{as:"p",variant:"bodySm",tone:"subdued",children:["Products: ",h.map(o=>o.title).join(", ")]})]})})}}):e.jsx(I,{padding:"600",children:e.jsxs(b,{gap:"400",align:"center",children:[e.jsx(V,{source:q,tone:"subdued"}),e.jsx(d,{as:"h3",variant:"headingMd",alignment:"center",children:"No Review Bundles configured yet"}),e.jsx(W,{onClick:()=>s("create",null),disabled:a,icon:Y,variant:"primary",children:"Create Your First Bundle"})]})})]})}function je({activeModal:c,modalType:a,handleModalClose:s,currentBundleName:u,bundleName:t,setBundleName:h,handleFormSubmit:m,isSubmitting:r,selectedProductGids:o,productMap:B,productSearchTerm:v,setProductSearchTerm:S,filteredProducts:y,handleProductSelection:g,currentBundleId:C,getNumericProductId:x}){var w;const M=n=>e.jsx(I,{paddingInlineEnd:"200",children:e.jsx(ae,{source:n.imageUrl||`https://placehold.co/80x80/f6f6f7/6d7175?text=${encodeURIComponent(n.title.split(" ")[0])}`,alt:`Image of ${n.title}`,size:"small"})});return e.jsx(L,{open:c&&(a==="create"||a==="edit"),onClose:s,title:a==="create"?"Create New Review Bundle":`Edit Bundle: ${u}`,size:"large",primaryAction:{content:a==="create"?"Create Bundle":"Save Changes",onAction:()=>m(`${a}-bundle`,C),loading:r,disabled:!t.trim()||o.length<2||r},secondaryActions:[{content:"Cancel",onAction:s}],children:e.jsx(L.Section,{children:e.jsxs(b,{gap:"500",children:[e.jsx(H,{label:"Bundle Name",value:t,onChange:h,helpText:"A unique name for this review group (e.g., 'Summer Collection')",autoComplete:"off",disabled:r}),e.jsx(z,{tone:"info",children:e.jsxs(b,{gap:"200",children:[e.jsx(d,{as:"p",variant:"bodyMd",children:"Select the products to be included in this bundle. The **first product selected** will be the default Bundle Product ID. You must select at least **2 products**."}),o.length>0&&e.jsxs(d,{as:"p",variant:"bodySm",fontWeight:"semibold",tone:"success",children:["Main Product: ",((w=B.get(o[0]))==null?void 0:w.title)||"Selecting..."]})]})}),e.jsxs(Q,{padding:"0",children:[e.jsx(I,{padding:"400",children:e.jsx(H,{label:"Search Products to Include",value:v,onChange:S,autoComplete:"off",disabled:r,placeholder:"Search by title or ID..."})}),e.jsx(J,{resourceName:{singular:"product",plural:"products"},items:y,renderItem:n=>{const j=o.includes(n.id),k=j&&o[0]===n.id;return e.jsx(K,{id:n.id,media:M(n),onClick:()=>g(n.id),children:e.jsxs(me,{columns:"1fr auto",gap:"400",alignItems:"center",children:[e.jsxs(b,{gap:"100",children:[e.jsx(d,{as:"h3",variant:"bodyLg",fontWeight:"semibold",children:n.title}),e.jsxs(d,{as:"p",variant:"bodyMd",tone:"subdued",children:["ID: ",n.numericId]})]}),e.jsxs(E,{gap:"200",children:[k&&e.jsx($,{tone:"info",children:"Main ID"}),e.jsx("div",{onClick:A=>A.stopPropagation(),children:e.jsx(ne,{label:"",labelHidden:!0,checked:j,onChange:()=>g(n.id)})})]})]})})}})]}),e.jsxs(I,{padding:"400",background:"bg-fill-secondary",borderRadius:"200",children:[e.jsxs(d,{as:"h4",variant:"bodyMd",fontWeight:"semibold",children:["Selected Products (",o.length,")"]}),e.jsx(b,{gap:"100",children:o.map(n=>{var j;return e.jsxs(E,{align:"space-between",blockAlign:"center",children:[e.jsx(d,{as:"span",variant:"bodySm",children:((j=B.get(n))==null?void 0:j.title)||x(n)}),e.jsx(W,{icon:se,onClick:()=>g(n),size:"slim",variant:"plain",tone:"critical"})]},n)})})]})]})})})}function fe({activeModal:c,modalType:a,handleModalClose:s,currentBundleName:u,handleFormSubmit:t,currentBundleId:h,isSubmitting:m}){return e.jsx(L,{open:c&&a==="delete",onClose:s,title:"Delete Review Bundle",primaryAction:{content:"Delete Bundle",onAction:()=>t("delete-bundle",h),destructive:!0,loading:m},secondaryActions:[{content:"Cancel",onAction:s}],children:e.jsx(L.Section,{children:e.jsxs(b,{gap:"400",children:[e.jsxs(d,{as:"p",variant:"bodyLg",children:["Are you sure you want to delete the bundle **",u,"**?"]}),e.jsx(z,{tone:"warning",children:"This action will **only delete the bundle configuration**. Existing reviews and syndicated links will remain in the database, but no further syndication will occur for these products."})]})})})}function De(){const{bundles:c,isSubmitting:a,activeModal:s,modalType:u,currentBundle:t,bundleName:h,selectedProductGids:m,activeToast:r,toastMessage:o,toastError:B,productSearchTerm:v,productMap:S,filteredProducts:y,setBundleName:g,setProductSearchTerm:C,handleModalOpen:x,handleModalClose:M,handleProductSelection:w,handleFormSubmit:n,setActiveToast:j}=pe(),k=P=>P.productIds.map(T=>{const D=F(T);return S.get(D)||{id:D,title:`Product ${T} (Not found)`,handle:"#",imageUrl:null,numericId:T}}),A=r?e.jsx(he,{content:o,onDismiss:()=>j(!1),error:B}):null;return e.jsxs(ce,{fullWidth:!0,children:[e.jsx(ge,{title:"Review Bundles Management"}),e.jsx(G,{children:e.jsx(G.Section,{children:e.jsxs(b,{gap:"400",children:[e.jsx(z,{title:"Review Syndication Feature",tone:"info",children:e.jsxs(b,{gap:"200",children:[e.jsx(d,{as:"p",variant:"bodyMd",children:"Create **Review Bundles** to automatically share approved reviews between a group of products."}),e.jsx(d,{as:"p",variant:"bodyMd",fontWeight:"semibold",children:"The **first product selected** in a bundle will be designated as the main bundle ID."}),e.jsx(d,{as:"p",variant:"bodySm",tone:"subdued",children:"If any product in a bundle receives an approved review, that review will be syndicated (copied) to all other products in that bundle."})]})}),e.jsx(xe,{bundles:c,isSubmitting:a,handleModalOpen:x,getProductsForBundle:k})]})})}),e.jsx(je,{activeModal:s,modalType:u,handleModalClose:M,currentBundleName:t==null?void 0:t.name,bundleName:h,setBundleName:g,handleFormSubmit:n,isSubmitting:a,selectedProductGids:m,productMap:S,productSearchTerm:v,setProductSearchTerm:C,filteredProducts:y,handleProductSelection:w,currentBundleId:t==null?void 0:t.id,getNumericProductId:ie}),e.jsx(fe,{activeModal:s,modalType:u,handleModalClose:M,currentBundleName:t==null?void 0:t.name,handleFormSubmit:n,currentBundleId:t==null?void 0:t.id,isSubmitting:a}),A]})}export{De as default};
